<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Juniorgram: How to add a 3rd party packages into the workflow and Docker</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="juniorgram_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Juniorgram<span id="projectnumber">&#160;0.6</span>
   </div>
   <div id="projectbrief">C++ written messenger! Never before and never again!</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">How to add a 3rd party packages into the workflow and Docker</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ol type="1">
<li>How to add packages into the workflow</li>
</ol>
<p>How to add packages into Docker image</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Workflow and GitHub Actions.</h1>
<p>A workflow is a configurable automated process made up of one or more jobs. You must create a YAML file to define your workflow configuration. <b>If you might need it!</b></p>
<h2><a class="anchor" id="autotoc_md29"></a>
About YAML syntax for workflows</h2>
<p>Workflow files use YAML syntax, and must have either a .yml or .yaml file extension. If you're new to YAML and want to learn more, see <a href="https://www.codeproject.com/Articles/1214409/Learn-YAML-in-five-minutes">"Learn YAML in five minutes."</a></p>
<p>In our repository we store workflow files in the .github/workflows directory. (build.yml) </p><hr  />
<p>Here is an example of how to write such a file and how to include the packages we need:</p>
<ul>
<li>The name of your workflow. GitHub displays the names of your workflows on your repository's actions page. If you omit name, GitHub sets it to the workflow file path relative to the root of the repository.</li>
</ul>
<div class="fragment"><div class="line">name: Clang-Build</div>
</div><!-- fragment --><ul>
<li>Required. The name of the GitHub event that triggers the workflow. You can provide a single event string, array of events, array of event types, or an event configuration map that schedules a workflow or restricts the execution of a workflow to specific files, tags, or branch changes. For a list of available events, see <a href="https://docs.github.com/en/articles/events-that-trigger-workflows">"Events that trigger workflows."</a></li>
</ul>
<p>Example using a single event: </p><div class="fragment"><div class="line"># Triggered when code is pushed to any branch in a repository</div>
<div class="line">on: push</div>
</div><!-- fragment --><p> Example using a list of events </p><div class="fragment"><div class="line"># Triggers the workflow on push or pull request events</div>
<div class="line">on: [push, pull_request]</div>
</div><!-- fragment --><p> Another example </p><div class="fragment"><div class="line"># Controls when the action will run. Triggers the workflow on push or pull request</div>
<div class="line"># events but only for the master branch</div>
<div class="line">on:</div>
<div class="line">  push:</div>
<div class="line">    branches: [ master,dev/develop,dev/coroutine,dev/clang_build]</div>
<div class="line">  pull_request:</div>
<div class="line">    branches: [ master,dev/develop,dev/coroutine]</div>
</div><!-- fragment --><ul>
<li>A workflow run is made up of one or more jobs. Jobs run in parallel by default. To run jobs sequentially, you can define dependencies on other jobs using the jobs.&lt;job_id&gt;.needs keyword.</li>
</ul>
<p>Each job runs in a runner environment specified by runs-on.</p>
<p>You can run an unlimited number of jobs as long as you are within the workflow usage limits.</p>
<p>Each job must have an id to associate with the job. The key job_id is a string and its value is a map of the job's configuration data. You must replace &lt;job_id&gt; with a string that is unique to the jobs object. The &lt;job_id&gt; must start with a letter or _ and contain only alphanumeric characters, -, or _.</p>
<p>Example </p><div class="fragment"><div class="line">jobs:</div>
<div class="line">  my_first_job:</div>
<div class="line">    name: My first job</div>
<div class="line">  my_second_job:</div>
<div class="line">    name: My second job</div>
<div class="line">jobs.&lt;job_id&gt;.name</div>
</div><!-- fragment --><p> The name of the job displayed on GitHub.</p>
<p>jobs.&lt;job_id&gt;.needs Identifies any jobs that must complete successfully before this job will run. It can be a string or array of strings. If a job fails, all jobs that need it are skipped unless the jobs use a conditional expression that causes the job to continue.</p>
<div class="fragment"><div class="line">Example requiring dependent jobs to be successful</div>
<div class="line">jobs:</div>
<div class="line">  job1:</div>
<div class="line">  job2:</div>
<div class="line">    needs: job1</div>
<div class="line">  job3:</div>
<div class="line">    needs: [job1, job2]</div>
</div><!-- fragment --><p>In this example, job1 must complete successfully before job2 begins, and job3 waits for both job1 and job2 to complete. The jobs in this example run sequentially: job1, job2, job3.</p>
<ul>
<li>GitHub-hosted runners If you use a GitHub-hosted runner, each job runs in a fresh instance of a virtual environment specified by runs-on.</li>
</ul>
<p>Available GitHub-hosted runner types are: \ Windows <a class="el" href="class_server.html" title="This class does all logic which is needed to run the server.">Server</a> 2019 \ Ubuntu 20.04 \ Ubuntu 18.04 \ Ubuntu 16.04 \ macOS Big Sur 11.0 \ macOS Catalina 10.15</p>
<p>Example </p><div class="fragment"><div class="line">runs-on: ubuntu-latest</div>
</div><!-- fragment --><p><b>Self-hosted runners</b> To specify a self-hosted runner for your job, configure runs-on in your workflow file with self-hosted runner labels.</p>
<p>All self-hosted runners have the self-hosted label, and you can select any self-hosted runner by providing only the self-hosted label. Alternatively, you can use self-hosted in an array with additional labels, such as labels for a specific operating system or system architecture, to select only the runner types you specify.</p>
<p>Example </p><div class="fragment"><div class="line">runs-on: [self-hosted, linux]</div>
</div><!-- fragment --><ul>
<li>Workflow dispatch Allows you to run this workflow manually from the Actions tab. Example <div class="fragment"><div class="line">workflow_dispatch:</div>
</div><!-- fragment --> Result - we can click to button 'Run workflow'</li>
</ul>
<p><img src="https://i2.wp.com/user-images.githubusercontent.com/1865328/86147571-2de93700-babf-11ea-8a08-e4beffd3abe9.png?ssl=1" alt="" class="inline"/></p>
<ul>
<li>Steps represent a sequence of tasks that will be executed as part of the job.</li>
</ul>
<ol type="1">
<li>All config is written in yaml, so it is important to follow the syntax and indentation, a new entity in the list starts with "-"</li>
<li>The steps are essentially an ordered list. They will be executed one by one strictly in sequence</li>
</ol>
<p>Example </p><div class="fragment"><div class="line">steps:</div>
</div><!-- fragment --><ul>
<li>Name. Name is just for display in the interface, you can do without it just fine.</li>
</ul>
<p>Example </p><div class="fragment"><div class="line">name: build</div>
</div><!-- fragment --><ul>
<li>Uses. Specify an action to run as part of a step in your job. You can use an action defined in the same repository as the workflow, a public repository elsewhere on GitHub, or in a published Docker container image. Here we specify the name of some already written action, if we want to use it. The action can be a specific branch in a specific repository (any repository), it can be code stored in a neighboring folder, or it can be a docker-image (<a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsuses">full list</a>) This example uses <code>actions/checkout@v2</code>. You can easily find them <a href="https://github.com/marketplace/actions/checkout">by name</a> in the marketplace and look at the source code of a specific version (it comes after the @ in the name) to see what they do. checkout does a pull of the repository and the branch in which it is running.</li>
</ul>
<p>tag is strongly recommended:</p>
<p>checks-out your repository under $GITHUB_WORKSPACE, so your job can access it </p><div class="fragment"><div class="line">uses: actions/checkout@v2</div>
</div><!-- fragment --><p> for actions in a public repository </p><div class="fragment"><div class="line">uses: {owner}/{repo}@{ref} </div>
</div><!-- fragment --><p> for actions in a subdirectory of a public repository </p><div class="fragment"><div class="line">uses: {owner}/{repo}/{path}@{ref} </div>
</div><!-- fragment --><p> for actions in a a subdirectory of the same repository </p><div class="fragment"><div class="line">uses: ./path/to/dir </div>
</div><!-- fragment --><p> for actions on Docker Hub </p><div class="fragment"><div class="line">uses: docker://{image}:{tag} </div>
</div><!-- fragment --><p> for actions in a public registry </p><div class="fragment"><div class="line">uses: docker://{host}/{image}:{tag} </div>
</div><!-- fragment --><ul>
<li>Run. Runs some command in the shell. You can't use a shell command together with an action, they must live in different steps</li>
</ul>
<div class="fragment"><div class="line">run: |</div>
<div class="line">  sudo docker build . -t juniorgram:1.0</div>
<div class="line">  docker run --rm --name juniorgram-container juniorgram:1.0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md30"></a>
How to add packages into the workflow</h2>
<ul>
<li>Let's move on to the most important thing, how do we use the packages that we need. It really depends on the environment in which you are running virtual machine on Github or locally.</li>
</ul>
<p>If you want to use the packages needed to implement a new feature, it is recommended to first find out <b>if they are included in the standard build of the machine</b> on which you want to test your feature. Take, for example, ubuntu.We need cmake for the build but we have it in the standard build, then we know that ubuntu has the apt package manager and we can use it to install our cmake.</p>
<p>Example</p>
<div class="fragment"><div class="line">- name: Setup CMake</div>
<div class="line">   run: |</div>
<div class="line">     sudo apt-get -y install cmake</div>
<div class="line">     cmake --version </div>
</div><!-- fragment --><p> We also do sudo <code>sudo apt update</code> to get the latest version of the packages we need. The following example shows how we can use a package that is originally in the ubuntu distribution:</p>
<div class="fragment"><div class="line">- name: Build Docker image.</div>
<div class="line">  run: |</div>
<div class="line">    sudo docker build . -t juniorgram:1.0</div>
<div class="line">    docker run --rm --name juniorgram-container juniorgram:1.0</div>
</div><!-- fragment --><p>The following examples show you how to install certain packages:</p>
<div class="fragment"><div class="line">- name: Setup CLang compiler</div>
<div class="line">      run: |</div>
<div class="line">        sudo apt-get update</div>
<div class="line">        sudo apt-get -y update</div>
<div class="line">        sudo bash -c &quot;$(wget -O - https://apt.llvm.org/llvm.sh)&quot;</div>
<div class="line">    - name: Setup CMake</div>
<div class="line">      run: |</div>
<div class="line">        sudo apt-get -y install cmake</div>
<div class="line">        cmake --version</div>
<div class="line">    - name: Setup python</div>
<div class="line">      uses: actions/setup-python@v2</div>
<div class="line">      with:</div>
<div class="line">        python-version: &#39;3.8&#39;</div>
<div class="line"> </div>
<div class="line">    - name: Install pip dependencies</div>
<div class="line">      uses:  BSFishy/pip-action@v1</div>
<div class="line">      with:</div>
<div class="line">        packages: |</div>
<div class="line">          conan</div>
<div class="line">          mako</div>
<div class="line">    - name: Setup conan dependencies</div>
<div class="line">      run: |</div>
<div class="line">        conan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan</div>
<div class="line">    - name: Download libraries from Conan</div>
<div class="line">      run: |</div>
<div class="line">        export CC=/usr/bin/clang</div>
<div class="line">        export CXX=/usr/bin/clang++</div>
<div class="line">        mkdir ${{ github.workspace }}/Firmware/build &amp;&amp; cd ${{ github.workspace }}/Firmware/build</div>
<div class="line">        conan install ${{ github.workspace }}/Firmware/conanfile.txt --install-folder ${{ runner.workspace }}/Firmware/build/  -s compiler=clang -s compiler.version=10 --build=missing</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md31"></a>
How to add packages into Docker image</h1>
<p>Below is an example of our docker file and how it looks like to install the necessary packages. You can use this file to make your own docker file with the packages you need.</p>
<p>Our Dockerfile: </p><div class="fragment"><div class="line">FROM alpine:latest - specifies the base (parent) image.</div>
<div class="line"> </div>
<div class="line">COPY . /usr/src/build - copies the contents of the current directory to /usr/src/build.</div>
<div class="line"> </div>
<div class="line">WORKDIR /usr/src/build - sets current directory as working directory. All commands will be built from <span class="keyword">this</span> directory.</div>
<div class="line"> </div>
<div class="line">RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache cmake make gcc g++ bash git python3 linux-headers - his line specifies the packages you need to run. They are listed with a space after the --no-cache flag. </div>
<div class="line"> </div>
<div class="line">RUN wget -qO- https:<span class="comment">//bootstrap.pypa.io/get-pip.py | python3 \</span></div>
<div class="line"><span class="comment">&amp;&amp; pip3 install conan - in this line we use wget to download the file and give the output from the downloaded file to the python3 interpreter, pip3 is installed and conan is installed to install the libraries. </span></div>
<div class="line"> </div>
<div class="line">RUN cmake -DCMAKE_BUILD_TYPE=Release . \</div>
<div class="line">&amp;&amp; cmake --build . - run build project</div>
</div><!-- fragment --><p> Again, since we are using the alpine distribution, before installing the necessary packages, it is worth looking to see if they are in the apk package manager(<a href="https://pkgs.alpinelinux.org/packages">packages list</a>). If they are there, you can install them as shown in the example. If not, then it makes sense to see if these packages are in pip. If not, then there is an option to build from source files :) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
